unit uFrmCadastroAnimais;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs, FMX.Objects,
  FMX.Layouts, FMX.Memo.Types, FMX.ScrollBox, FMX.Memo, FMX.ListBox, FMX.Edit,
  FMX.Controls.Presentation, FMX.StdCtrls, System.Actions, FMX.ActnList, u99Permissions,
  FMX.StdActns, FMX.MediaLibrary.Actions;

type
  TfrmCadastroAnimais = class(TForm)
    Layout2: TLayout;
    Rectangle1: TRectangle;
    imgVoltar: TImage;
    Image1: TImage;
    Image2: TImage;
    VertScrollBox1: TVertScrollBox;
    Layout1: TLayout;
    Label8: TLabel;
    Layout4: TLayout;
    Layout3: TLayout;
    Label1: TLabel;
    edtNome: TEdit;
    Layout9: TLayout;
    Label13: TLabel;
    edtTelefone: TEdit;
    imgAnimais: TImage;
    ActionList1: TActionList;
    actBuscaFoto: TTakePhotoFromLibraryAction;
    Layout7: TLayout;
    Label3: TLabel;
    Edit1: TEdit;
    Cas: TLabel;
    Label2: TLabel;
    cbxTelas: TComboBox;
    cbxTipoAnimal: TComboBox;
    ComboBox1: TComboBox;
    Label4: TLabel;
    Layout8: TLayout;
    Label5: TLabel;
    edtCep: TEdit;
    Layout6: TLayout;
    Layout10: TLayout;
    edtCidade: TEdit;
    Label7: TLabel;
    Layout11: TLayout;
    mmoInformacoes: TMemo;
    Label10: TLabel;
    Layout5: TLayout;
    btnCriarConta: TRoundRect;
    Label9: TLabel;
    Layout12: TLayout;
    Label6: TLabel;
    edtRua: TEdit;
    edtNumero: TEdit;
    Label12: TLabel;
    cFotoEditar: TCircle;
    Label11: TLabel;
    Label14: TLabel;
    procedure imgAnimaisClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
    procedure actBuscaFotoDidFinishTaking(Image: TBitmap);
    procedure btnCriarContaClick(Sender: TObject);
  private
    { Private declarations }
    permissao: T99Permissions;
    procedure TratarErroPermissao(Sender: TObject);
  public
    { Public declarations }
  end;

var
  frmCadastroAnimais: TfrmCadastroAnimais;

implementation

{$R *.fmx}

uses uDtmServidor;

procedure TfrmCadastroAnimais.actBuscaFotoDidFinishTaking(Image: TBitmap);
begin
   cFotoEditar.Fill.Bitmap.Bitmap := Image;
//     actFoto.Execute;
     if not cFotoEditar.Fill.Bitmap.Bitmap.IsEmpty then
     begin
          //Label15.Visible := True;
     end
     else
         begin
//              Label15.Visible := False;
         end;
end;

procedure TfrmCadastroAnimais.btnCriarContaClick(Sender: TObject);
begin
   try
      dtmServidor.qryGeral.Active := False;
      dtmServidor.qryGeral.SQL.Clear;
      dtmServidor.qryGeral.SQL.Text := ' insert into Animais (Nome,               '+
                                       '                      Idade,              '+
                                       '                      Genero,             '+
                                       '                      Cor_Pelagem,        '+
                                       '                      CEP,                '+
                                       '                      Endereco,           '+
                                       '                      Cidade,             '+
                                       '                      Tipo_Animal,        '+
                                       '                      Ind_Ativo,          '+
                                       '                      Foto,               '+
                                       '                      Informacoes,        '+
                                       '                      Cod_Pessoa,         '+
                                       '                      Cod_Lar             '+
                                       '                    values (:Nome,        '+
                                       '                            :Idade,       '+
                                       '                            :Genero,      '+
                                       '                            :Cor_Pelagem, '+
                                       '                            :CEP,         '+
                                       '                            :Endereco,    '+
                                       '                            :Cidade,      '+
                                       '                            :Tipo_Animal, '+
                                       '                            :ind_ativo,   '+
                                       '                            :foto,        '+
                                       '                            :informacoes, '+
                                       '                            :cod_pessoa,  '+
                                       '                            :cod_lar);    ';

//      dtmServidor.qryGeral.ParamByName('nome_pessoa').AsString := edtNome.Text;
//      dtmServidor.qryGeral.ParamByName('telefone').AsString := edtTelefone.Text;
//      dtmServidor.qryGeral.ParamByName('cep').AsString := edtCep.Text;
//      dtmServidor.qryGeral.ParamByName('endereco').AsString := edtRua.Text;
//      dtmServidor.qryGeral.ParamByName('cidade').AsString := edtCidade.Text;
//      dtmServidor.qryGeral.ParamByName('qtd_animais').AsString := edtQuantidade.Text;
//      dtmServidor.qryGeral.ParamByName('ind_telas').AsInteger := cbxTelas.ItemIndex;
//      dtmServidor.qryGeral.ParamByName('informacoes').AsString := mmoInformacoes.Text;
//      dtmServidor.qryGeral.ParamByName('ind_ativo').AsString := '1';
//      dtmServidor.qryGeral.ParamByName('cod_pessoa').AsString := frmLogin.sUsuarioLogado;

      dtmServidor.qryGeral.ExecSQL;

      if dtmServidor.fdConexao.InTransaction then
      begin
         dtmServidor.fdConexao.Commit;
      end;
   finally
//      TLoading.ToastMessage(frmCadastroLarTemporario,
//                            'Cadastrado com sucesso!',
//                             $FF22AF70,
//                             TAlignLayout.Bottom);
//      frmPaginaInicial.Show;
   end;
end;

procedure TfrmCadastroAnimais.FormCreate(Sender: TObject);
begin
   permissao := T99Permissions.Create;
end;

procedure TfrmCadastroAnimais.FormDestroy(Sender: TObject);
begin
   permissao.DisposeOf;
end;

procedure TfrmCadastroAnimais.TratarErroPermissao(Sender: TObject);
begin
   ShowMessage('Você não possui permissão para este recurso!');
end;

procedure TfrmCadastroAnimais.imgAnimaisClick(Sender: TObject);
begin
   {$IFDEF MSWINDOWS}
   {$ELSE}
   permissao.PhotoLibrary(actBuscaFoto, TratarErroPermissao);
   {$ENDIF}
end;

end.
